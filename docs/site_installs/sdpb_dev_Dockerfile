FROM scratch
ADD rootfs.tar.xz /

RUN apt-get update && apt-get -y dist-upgrade && echo "Wed Jun 23 10:02:48 2021"
RUN apt-get -y install openmpi-bin libopenmpi-dev libgmp-dev libmpfr-dev libmpfrc++-dev libboost-all-dev g++ cmake libopenblas-dev libxml2-dev git libmetis-dev pkg-config libeigen3-dev libtrilinos-sacado-dev libtrilinos-kokkos-dev libtrilinos-teuchos-dev rapidjson-dev libarchive-dev libfmt-dev
WORKDIR /usr/local/src
RUN git clone https://gitlab.com/bootstrapcollaboration/elemental.git && cd elemental && git log -1 7a0a7498f776998c69b6e8276a48942caf0521fc
RUN mkdir -p elemental/build
RUN cd elemental/build && cmake .. -DCMAKE_CXX_COMPILER=mpicxx -DCMAKE_C_COMPILER=mpicc -DCMAKE_INSTALL_PREFIX=/usr/local/
RUN cd elemental/build && make -j `nproc`
RUN cd elemental/build && make install
RUN git clone https://github.com/davidsd/sdpb && cd sdpb && git log -1 3c98deb34e9fa72825570b75a6de5776c786d70c
RUN cd sdpb && ./waf configure --elemental-dir=/usr/local --prefix=/usr/local
RUN cd sdpb && ./waf && ./waf install
RUN git clone https://gitlab.com/bootstrapcollaboration/scalar_blocks.git && cd scalar_blocks && git log -1 eb0bb69d62b73256d27e50d261c9cf3820f20282
RUN cd scalar_blocks && CXX=mpicxx ./waf configure --prefix=/usr/local
RUN cd scalar_blocks && ./waf && ./waf install
RUN git clone https://gitlab.com/bootstrapcollaboration/blocks_3d.git && cd blocks_3d && git log -1 4b18e2420249b443b1560f4c0db09ec52b9508e6
RUN cd blocks_3d && ./waf configure --prefix=/usr/local
RUN cd blocks_3d && ./waf && ./waf install
RUN git clone https://gitlab.com/bootstrapcollaboration/spectrum-extraction.git && cd spectrum-extraction
RUN install spectrum-extraction/spectrum.py /usr/local/bin
RUN ln -s /usr/bin/python3 /usr/local/bin/python
ADD mpsolve.tgz .
RUN cd MPSolve-2.2 && make -j && install unisolve /usr/local/bin
